---
layout: single
title: "MLOps란 무엇인가"
author_profile: true
excerpt: "MLOps, MLOps level, "
categories:
    - MLOps
---


다음 글은 구글의 MLOps에 관한 글을 번역하였다.

구글에서 말하는 MLOps의 단계를 알아보고 현재 우리 회사는 어떤 단계이고, 어떤 것들을 추가해나가면 좋을 지 생각해보자.

MLOps는 머신러닝의 지속적 배포 및 자동화 파이프라인을 의미한다. ML 시스템을 위한 CI(Continuous Integration), CD(Continuous Deplyment), CT(Continuous Training) 를 구현하고 자동화하는 기술을 의미한다. 

DevOps 원칙을 MLOps에 적용하는 것이다. MLOps는 ML 시스템 개발(Dev) 과 ML 시스템 운영(Operation)을 통합하는 것을 목표로 하는 ML 엔지니어링 문화 및 방식이다. MLOps 수행을 통해서 통합, 테스트, 출시, 배포, 인프라 관리를 비롯하여 ML 시스템 구성의 모든 단계에서 자동화 및 모니터링을 지원하도록 한다.



## ML 시스템의 특성

- **팀 기술** : ML 프로젝트에서 팀은 일반적으로 탐색적 데이터 분석, 모델 개발, 실험에 중점을 두는 데이터 과학자 또는 ML 연구원을 포함한다. 이러한 구성원 중 프로덕션 수준의 서비스를 빌드 할 수 있는 엔지니어가 없을 수 있다.
- **개발** : ML은 기본적으로 실험적이다. 피처, 알고리즘, 모델링 기법, 매개변수 구성을 다양하게 시도하여 문제에 가장 적합한 것을 찾아내야 한다. 효과가 있었던 것을 추적하고, 코드 재사용성을 극대화하면서 재현성을 유지해야 한다.
- **테스트** : ML 시스템 테스트는 다른 시스템보다 더 복잡하다. 일반적인 단위 및 통합 테스트 외에도 데이터 검증, 학습된 모델 품질평가, 모델 검증이 필요하다.
- **배포** : ML 시스템에서 배포는 오프라인으로 학습된 ML 모델을 예측 서비스로 배포하는 것이 그리 간단하지 않다. ML 시스템을 사용하면 모델을 자동으로 재학습시키고 배포하기 위해 다단계 파이프라인을 배포할 수 있어야 한다. 그리고 배포 전에 데이터 과학자가 모델을 검증하는 과정을 수행해야 하는데 이 단계를 자동화해야 한다.
- **프로덕션** : ML 모델은 최적화되지 않은 코딩뿐만 아니라 지속적으로 진화하는 데이터 프로필로 인해 성능이 저하될 수 있다. 즉 모델은 기존 성능보다 저하될 수 있기 때문에 이를 고려해야 한다. 따라서 데이터의 요약 통계를 추적하고 모델의 온라인 성능을 모니터링하여 값이 기대치를 벗어나면 알림을 전송하거나 롤밸해야 한다.
- CI는 코드 및 구성요소만 테스트하고 검증하는 것이 아니라, 데이터, 데이터 스키마, 모델도 테스트하고 검증해야 한다.
- CD는 모델 예측 서비스를 자동으로 배포해야 하는 시스템(ML 학습 파이프라인)이다.
- CT는 ML 시스템에 고유한 새 속성으로, 모델을 자동으로 재학습시키고 제공하는데 사용된다.



## ML을 위한 데이터 과학 업무과정

- **데이터 추출** : 다양한 소스에서 관련 데이터를 선택하고 통합한다.
- **데이터 분석** : 사용할 데이터를 이해하기 위해 탐사적 데이터 분석(EDA)를 수행한다. 이러한 과정을 통해 다음 결과과 발생한다.
  - 모델에서 예상하는 데이터 스키마 및 피처 이해
  - 모델에 필요한 데이터 준비 및 피처 추출 식별

- **데이터 준비** : 데이터 정리 및 데이터를 학습, 검증, 테스트 세트로 분할한다.
- **모델 학습** : 데이터 과학자는 다양한 알고리즘으로 모델을 학습시킨다. 결과는 학습된 모델 파일이다.
- **모델 평가** : 모델 품질을 평가하기 위해 홀드아웃 테스트 세트에서 모델을 평가한다. 결과는 평가 측정항목 집합
- 모델 검증 : 예측 성능이 특정 기준보다 우수하면 모델이 배포에 적합한 것으로 확인된다.
- **모델 제공** : 검증된 모델을 예측 서비스 환경에 배포된다. 이 배포는 다음 중 하나일 수 있다.
  - 온라인 예측을 제공하기 위해 REST API가 포함된 마이크로서비스
  - 에지 또는 휴대기기에 삽입된 모델
  - 일괄 예측 시스템의 일부
- **모델 모니터링** : 모델 예측 성능이 모니터링되어 ML 프로세스에서 새로운 반복을 호출 할 수 있다. (예를들면 모델 성능이 떨어지는 경우 알람을 통해 데이터 과학자에게 알리고 데이터를 추가하여 더 나은 모델을 학습시켜 배포하는 형태가 될 수 있다.)



이러한 일련의 과정의 자동화 정도가 ML 시스템의 성숙도를 나타낸다. 다음은 MLOps의 성숙도를 단계별로 알아보자.



## MLOps 수준 0단계 : 수동 프로세스

이 단계는 ML 모델을 빌드하고 배포하는 과정은 완전히 수동으로 이루어지는 단계이다. 다음 다이어그램은 이러한 수동 프로세스의 워크 플로우를 보여준다.

0단계의 특성을 살펴보자.

- **수동, 스크립트기반, 대화형 프로세스** : 데이터 분석, 데이터 준비, 모델 학습, 모델 검증을 포함한 모든 단계가 수동이다. 각 단계를 수동으로 실행하며, 다음 단계도 수동으로 전환해야 한다. 이 프로세스는 작업자가 작성하고 실행하는 실험코드에 의해 이루어진다.
- **ML과 운영 간 분리** : 모델을 만드는 데이터 과학자와 모델을 예측 서비스로 제공하는 엔지니어를 분리한다. 데이터 과학자는 엔지니어링 팀에 학습된 모델을 전달하여 API 인프라에 배포한다. 이 전달은 모델을 스토리지 위치에 배치하거나, 코드 저장소에 확인하거나, 레지스트리에 업로드 하는 작업이 포함된다. 엔지니어는 짧은 지연 시간을 제공하기 위해 필요한 기능을 프로덕션 단계에서 사용할 수 있도록 해야한다. 이것으로 인해 [**training-serving skew**](https://developers.google.com/machine-learning/guides/rules-of-ml/#training-serving_skew) 가 발생할 수 있다.
- **간헐적인 출시 반복** : 잦은 배포가 일어나지 않고, 1년에 두 어번만 배포된다.
- **CI,CD 없음** : 구현 변경사항이 거의 없으므로 CI가 무시되고, 배포도 자주 되지 않으므로 CD가 없음
- **예측 서비스를 의미하는 배포** : 이 프로세스는 전체 ML 시스템을 배포하는 대신 예측 서비스(예: REST API가 포함된 마이크로 서비스)로 학습된 모델을 배포하는 것과 관련이 있다.
- **Active 성능 모니터링 부족** : 프로세스가 모델 성능 저하 및 기타 모델 동작 드리프트를 감지하는 데 필요한 모델 예측 및 작업을 추적하거나 로깅하지 않는다.

엔지니어링 팀은 보안, 회귀, 부하 및 카나리아 테스트를 비롯하여 API 구성, 테스트, 배포를 위한 자체적인 복잡한 설정을 가질 수 있다. 또한 일반적으로 새로운 ML 모델 버전의 프로덕션 배포는 일반적으로 A/B 테스트 또는 온라인 실험을 거친 후 배포된다.



### 도전과제

MLOps 0 단계는 ML을 적용하기 시작하는 많은 비즈니에서 일반적이다. 모델이 거의 변경되지 않거나 학습되지 않는 경우에는 이러한 데이터 과학자 기반 프로세스로도 충분할 수 있다. 하지만 실제 환경에 모델이 배포될 때 손상되는 경우가 많다. 그리고 모델 환경의 동적인 변화와 데이터의 변화에 적응하지 못한다. 자세한 내용은 아래 링크를 참고하자. [**Why Machine Learning Models Crash and Burn in Production**](https://www.forbes.com/sites/forbestechcouncil/2019/04/03/why-machine-learning-models-crash-and-burn-in-production/?sh=563254382f43)

이러한 문제를 해결하고 프로덕션 단계에서 모델의 정확성을 유지하려면 다음을 수행해야 한다.

- **프로덕션 단계에서 적극적으로 모델 품질을 모니터링** : 품질을 모니터링하면서 성능 저하 및 모델 비활성을 감지할 수 있다. 이는 새로운 실험이과 재학습의 필요성을 제기하는 역할을 한다.
- **프로덕션 모델 자주 재학습** : 진화하고 새로운 패턴을 포착하려면 최신 데이터로 모델을 재학습시켜야 한다.
- **모델을 생성하기 위한 새로운 구현을 지속적으로 실험** : 최신 아이디어와 기술의 발전을 활용하려면 피처 추출, 모델 아키텍처, 하이퍼파라미터 등의 새로운 구현을 시도해야 한다.

이러한 수동 프로세스의 도전 과제를 해결하려면 CI/CD 및 CT용 MLOps 방식이 도움이 된다. ML 학습 파이프라인을 배포하여 CT를 사용 설정할 수 있으며 CI/CD 시스템을 설정하여 ML 파이프라인의 새로운 구현을 빠르게 테스트, 빌드, 배포 할 수 있다.

